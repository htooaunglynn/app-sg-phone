<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataHub - Business Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/js/app.js" defer></script>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body style="background-color: var(--bg-primary); color: var(--text-primary);" class="font-sans">
    <!-- Navigation -->
    <nav class="glass-effect sticky top-0 z-50" style="box-shadow: var(--shadow-nav);">
        <div class="max-w-7xl mx-auto" style="padding: var(--spacing-md) var(--spacing-lg);">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        style="background-color: var(--accent-blue);">
                        <span class="font-bold text-sm" style="color: var(--text-primary);">D</span>
                    </div>
                    <span
                        style="font-weight: var(--font-weight-semibold); font-size: var(--font-size-lg); color: var(--text-primary);">DataHub</span>
                </div>
                <div class="flex items-center gap-4">
                    <a href="/" class="text-sm font-medium"
                        style="color: var(--text-tertiary); transition: color var(--transition-normal);"
                        onmouseover="this.style.color='var(--text-primary)'"
                        onmouseout="this.style.color='var(--text-tertiary)'">Home</a>
                    <button id="themeToggle" onclick="toggleTheme()" class="text-sm font-medium px-3 py-1.5 rounded-lg"
                        style="background-color: var(--bg-elevated); color: var(--text-secondary); transition: all var(--transition-normal);"
                        aria-label="Toggle theme">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <div class="flex items-center gap-2">
                        <% if (user) { %>
                            <span class="text-sm" style="color: var(--text-tertiary);">Hello, <%= user.name %></span>
                            <form action="/auth/logout" method="POST">
                                <button type="submit" class="btn-secondary text-sm">Logout</button>
                            </form>
                            <% } else { %>
                                <a href="/login" class="text-sm font-medium"
                                    style="color: var(--text-secondary); transition: color var(--transition-normal);"
                                    onmouseover="this.style.color='var(--text-primary)'"
                                    onmouseout="this.style.color='var(--text-secondary)'">Login</a>
                                <% } %>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Controls -->
        <div class="flex flex-col gap-4 mb-12">
            <div class="flex">
                <!-- Search Box -->
                <label for="searchInput" class="sr-only">Search companies</label>
                <input type="text" id="searchInput"
                    placeholder="Search by ID, company, email, phone, website, or address..."
                    class="search-input flex-1" onkeyup="filterTable()"
                    aria-label="Search by ID, company, email, phone, website, or address">
            </div>


            <!-- Buttons -->
            <div class="button-group">
                <button type="button" onclick="openExcelModal()" class="btn-primary flex items-center gap-2"
                    aria-label="Upload Excel file">
                    <span aria-hidden="true">‚Üë</span> Upload Excel
                </button>
                <!-- <button type="button" onclick="checkDuplicates()" class="btn-primary flex items-center gap-2"
                    aria-label="Check and fill duplicate phone numbers">
                    <span aria-hidden="true">üîç</span> Check Duplicates
                </button> -->
                <!-- <button type="button" onclick="checkEmpty()" class="btn-primary flex items-center gap-2"
                    aria-label="Check empty company/address">
                    <span aria-hidden="true">‚ú≥Ô∏è</span> Check Empty
                </button> -->
                <button type="button" onclick="exportToExcel()" class="btn-secondary flex items-center gap-2"
                    aria-label="Export all data to Excel">
                    <span aria-hidden="true">‚Üì</span> Export Excel
                </button>
                <button type="button" onclick="exportFinishData()" class="btn-secondary flex items-center gap-2"
                    aria-label="Export finish data to Excel">
                    <span aria-hidden="true">‚Üì</span> Export Finish Data
                </button>
                <button type="button" onclick="exportNoData()" class="btn-secondary flex items-center gap-2"
                    aria-label="Export records with no data">
                    <span aria-hidden="true">‚Üì</span> Export No Data
                </button>
                <button type="button" onclick="exportWrongNumber()" class="btn-secondary flex items-center gap-2"
                    aria-label="Export records with wrong numbers">
                    <span aria-hidden="true">‚Üì</span> Export Wrong Number
                </button>
            </div>
        </div>



        <!-- Table -->
        <div class="table-container">
            <table class="w-full text-sm table-auto">
                <thead>
                    <tr>
                        <th class="text-left whitespace-nowrap">No</th>
                        <th class="text-left whitespace-nowrap">ID</th>
                        <th class="text-left whitespace-nowrap">Phone</th>
                        <th class="text-left whitespace-nowrap">Company Name</th>
                        <th class="text-left whitespace-nowrap">Physical Address</th>
                        <th class="text-left whitespace-nowrap">Email</th>
                        <th class="text-left whitespace-nowrap">Website</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-left whitespace-nowrap">
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
            <div id="emptyState" class="empty-state">
                <p>No companies found. Upload an Excel file to get started.</p>
            </div>
        </div>

        <!-- Pagination -->
        <div id="paginationContainer" class="mt-4 w-full"></div>

        <!-- Validation Legend -->
        <div class="validation-legend glass-effect-light" role="region" aria-label="Phone number validation statistics">
            <h3 class="validation-legend-heading">Phone Number Validation (All Records):</h3>
            <div class="validation-legend-stats">
                <div class="validation-stat-item">
                    <div class="validation-indicator validation-indicator-duplicate" aria-hidden="true"></div>
                    <span class="validation-label">Duplicate Phone Number</span>
                    <span id="duplicateCount" class="validation-badge validation-badge-duplicate"
                        aria-live="polite">0</span>
                </div>
                <div class="validation-stat-item">
                    <div class="validation-indicator validation-indicator-invalid" aria-hidden="true"></div>
                    <span class="validation-label">Invalid Singapore Phone Number</span>
                    <span id="invalidCount" class="validation-badge validation-badge-invalid"
                        aria-live="polite">0</span>
                </div>
                <div class="validation-stat-item">
                    <div class="validation-indicator validation-indicator-finish" aria-hidden="true"></div>
                    <span class="validation-label">Finish Count</span>
                    <span id="finishCount" class="validation-badge validation-badge-finish" aria-live="polite">0</span>
                </div>
            </div>
            <div class="validation-legend-divider"></div>
            <div class="validation-total">
                <span class="validation-total-label">Total Records in Database:</span>
                <span id="totalCount" class="validation-badge validation-badge-total" aria-live="polite">0</span>
            </div>
        </div>
    </main>

    <!-- Excel Upload Modal -->
    <div id="excelModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4"
        role="dialog" aria-modal="true" aria-labelledby="excelModalTitle">
        <div class="modal-content max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 id="excelModalTitle" class="text-xl font-semibold">Upload Excel File</h2>
                <button type="button" onclick="closeExcelModal()" class="modal-close-btn"
                    aria-label="Close upload modal">‚úï</button>
            </div>

            <p class="text-sm mb-4">Upload an Excel file with columns: ID, Phone, Company Name, Physical
                Address, Email, Website</p>

            <div class="border-2 border-dashed rounded-lg p-8 text-center mb-4"
                style="border-color: var(--border-primary);">
                <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" class="hidden"
                    onchange="handleFileUpload(event)" aria-label="Excel file input">
                <button type="button" onclick="document.getElementById('excelFile').click()"
                    class="font-medium hover:underline" style="color: var(--accent-blue);"
                    aria-label="Browse for Excel file">
                    Click to browse or drag file
                </button>
                <p id="fileName" class="text-sm mt-2" style="color: var(--text-tertiary);" aria-live="polite"></p>
            </div>

            <!-- Upload status / animation -->
            <div id="uploadStatus" class="hidden mb-4 text-center" aria-live="polite">
                <div id="uploadSpinner" class="inline-flex items-center gap-2">
                    <svg class="w-6 h-6 animate-spin-slow" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <circle cx="12" cy="12" r="10" stroke="rgba(255,255,255,0.08)" stroke-width="4"></circle>
                        <path d="M22 12a10 10 0 00-10-10" stroke="var(--accent-blue)" stroke-width="4"
                            stroke-linecap="round"></path>
                    </svg>
                    <span id="uploadStatusText" class="text-sm" style="color: var(--text-secondary);">Preparing
                        upload...</span>
                </div>
            </div>

            <div class="button-group">
                <button id="excelCancelBtn" type="button" onclick="closeExcelModal()"
                    class="btn-secondary flex-1">Cancel</button>
                <button id="excelUploadBtn" type="button" onclick="uploadExcel()"
                    class="btn-primary flex-1">Upload</button>
            </div>
        </div>
    </div>

    <!-- Edit Company Modal -->
    <div id="editModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4"
        role="dialog" aria-modal="true" aria-labelledby="editModalTitle">
        <div class="modal-content max-w-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 id="editModalTitle" class="text-xl font-semibold">Edit Company</h2>
                <button type="button" onclick="closeEditModal()" class="modal-close-btn"
                    aria-label="Close edit modal">‚úï</button>
            </div>

            <div class="modal-form-fields">
                <div>
                    <label for="editId" class="block text-sm mb-1">ID</label>
                    <input id="editId" type="text" class="modal-input-readonly w-full" readonly aria-readonly="true">
                </div>
                <div>
                    <label for="editPhone" class="block text-sm mb-1">Phone</label>
                    <div class="flex gap-2">
                        <input id="editPhone" type="text" class="modal-input-readonly flex-1" readonly
                            aria-readonly="true">
                        <button type="button" onclick="copyPhoneNumber()"
                            class="btn-secondary px-3 py-2 text-sm whitespace-nowrap" aria-label="Copy phone number">üìã
                            Copy</button>
                    </div>
                    <div class="phone-search-buttons mt-1 flex gap-2">
                        <a id="editPhoneSearchPlus65" href="#" target="_blank" rel="noopener noreferrer"
                            class="phone-search-btn plus65 text-xs hover:underline"
                            aria-label="Search phone number with +65 prefix">+65 search</a>
                        <a id="editPhoneSearchQuotes" href="#" target="_blank" rel="noopener noreferrer"
                            class="phone-search-btn quotes text-xs hover:underline"
                            aria-label="Search phone number with quotes">'quotes' search</a>
                    </div>
                </div>
                <div>
                    <label for="editCompanyName" class="block text-sm mb-1">Company Name</label>
                    <div class="flex gap-2">
                        <input id="editCompanyName" type="text" class="modal-input flex-1" placeholder="Company Name">
                    </div>
                </div>
                <div>
                    <label for="editPhysicalAddress" class="block text-sm mb-1">Physical Address</label>
                    <div class="flex gap-2">
                        <input id="editPhysicalAddress" type="text" class="modal-input flex-1"
                            placeholder="Physical Address">
                    </div>
                </div>
                <div>
                    <label for="editEmail" class="block text-sm mb-1">Email</label>
                    <input id="editEmail" type="email" class="modal-input w-full" placeholder="Email">
                </div>
                <div>
                    <label for="editWebsite" class="block text-sm mb-1">Website</label>
                    <input id="editWebsite" type="text" class="modal-input w-full" placeholder="Website">
                </div>
            </div>

            <div class="button-group mt-6">
                <button type="button" onclick="closeEditModal()" class="btn-secondary flex-1">Cancel</button>
                <button type="button" onclick="markBothFieldsEmpty(this)"
                    class="btn-secondary px-3 py-2 text-sm whitespace-nowrap mx-2"
                    aria-label="Mark company name and address as empty">--- Empty</button>
                <button type="button" onclick="saveEdit()" class="btn-primary flex-1">Save</button>
            </div>
        </div>
    </div>
</body>

</html>
